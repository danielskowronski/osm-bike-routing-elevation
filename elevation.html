<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.0.min.js"></script>
<script>
const OSMURL=prompt("OSM URL with directions","https://www.openstreetmap.org/directions?engine=fossgis_osrm_bike&route=50.0776%2C19.9914%3B50.1012%2C19.9643")
const routingURLbegin="https://routing.openstreetmap.de/routed-bike/route/v1/driving/"
const routingURLend="?overview=false&geometries=polyline&steps=true"
const elevationURLbegin="http://open-elevation-api.skowronski.tech/api/v1/lookup?locations="

function getElevationResult(routeStepManeuver,returnObject){
	var request = new XMLHttpRequest();
	request.open("GET", elevationURLbegin+routeStepManeuver.location[1]+","+routeStepManeuver.location[0], false);
	request.send(null);
	if (request.status !== 200) {
		document.write("Elevation server thrown error. Pleasre refresh for another try.")
		throw new Error("xhr_elevation");
	}
	var resp = JSON.parse(request.responseText).results[0]
	console.log(resp)
	return resp.elevation;

}

if (OSMURL==null || OSMURL.indexOf("directions?engine=fossgis_osrm_bike&route=")<0){
	document.write("Incorrect URL. Pleasre refresh for another try.")
	throw new Error("incorrect_url");
}

var endpoints=decodeURIComponent(OSMURL.split("?")[1].split("&")[1].split("=")[1]).split("#")[0]
var e1=endpoints.split(";")[0].split(",")[0]
var e2=endpoints.split(";")[0].split(",")[1]
var e3=endpoints.split(";")[1].split(",")[0]
var e4=endpoints.split(";")[1].split(",")[1]

var request = new XMLHttpRequest();
request.open("GET", routingURLbegin+e2+","+e1+";"+e4+","+e3+routingURLend, false);
request.send(null);
if (request.status !== 200) {
	document.write("Routing server thrown error. Pleasre refresh for another try.")
	throw new Error("xhr_routing");
}
var routeSteps=JSON.parse(request.responseText).routes[0].legs[0].steps

for (i=0;i<routeSteps.length;i++){ 
	rs=routeSteps[i]
	rs.stepdescr=$("#turnbyturn tr")[i]
	rs.elevationFirst=null
	rs.elevationSecond=null

	rs.elevationFirst=getElevationResult(rs.maneuver)
	rs.elevationSecond=getElevationResult(rs.maneuver)
}

/*
$.get(
	routingURLbegin+e2+","+e1+";"+e4+","+e3+routingURLend,
	function(resp){
		window.routesteps=resp.routes[0].legs[0].steps

		for (i=0;i<window.routesteps.length;i++){ 
			rs=window.routesteps[i]
			rs.stepdescr=$("#turnbyturn tr")[i]
			rs.elevationFirst=null
			rs.elevationSecond=null
			getElevationResult(rs.maneuver,rs.elevationFirst)
			getElevationResult(rs.maneuver,rs.elevationSecond)
		}
	}
)
*/
</script>